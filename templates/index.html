<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Research Assistant</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <i class="fas fa-brain text-2xl"></i>
                    <h1 class="text-2xl font-bold">AI Research Assistant</h1>
                </div>
                <div class="text-sm opacity-90">
                    Powered by arXiv & AI
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-6 py-8">
        <!-- Search Form -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <form id="searchForm" class="space-y-4">
                <div>
                    <label for="query" class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-search mr-2"></i>Research Query
                    </label>
                    <input 
                        type="text" 
                        id="query" 
                        name="query" 
                        placeholder="e.g., transformer attention mechanisms, self-supervised learning..."
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        required
                    >
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="max_results" class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-list-ol mr-2"></i>Max Results
                        </label>
                        <select id="max_results" name="max_results" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="5">5 papers</option>
                            <option value="10" selected>10 papers</option>
                            <option value="15">15 papers</option>
                            <option value="20">20 papers</option>
                        </select>
                    </div>
                    
                    <div>
                        <label for="since" class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-calendar mr-2"></i>Published Since
                        </label>
                        <input 
                            type="date" 
                            id="since" 
                            name="since"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                        >
                    </div>
                </div>
                
                <button 
                    type="submit" 
                    id="searchBtn"
                    class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-6 rounded-lg transition duration-200 flex items-center justify-center"
                >
                    <i class="fas fa-search mr-2"></i>
                    <span id="searchBtnText">Search Papers</span>
                    <div id="searchSpinner" class="loading-spinner ml-2 hidden"></div>
                </button>
            </form>
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="hidden">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-gray-800">
                    <i class="fas fa-file-alt mr-2"></i>Research Results
                </h2>
                <div id="resultsCount" class="text-sm text-gray-600"></div>
            </div>
            
            <div id="results" class="space-y-6"></div>
        </div>

        <!-- Error Section -->
        <div id="errorSection" class="hidden">
            <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                <div class="flex items-center">
                    <i class="fas fa-exclamation-triangle text-red-500 mr-2"></i>
                    <span class="text-red-700 font-medium">Error</span>
                </div>
                <p id="errorMessage" class="text-red-600 mt-2"></p>
            </div>
        </div>
    </main>

    <script>
        const searchForm = document.getElementById('searchForm');
        const searchBtn = document.getElementById('searchBtn');
        const searchBtnText = document.getElementById('searchBtnText');
        const searchSpinner = document.getElementById('searchSpinner');
        const resultsSection = document.getElementById('resultsSection');
        const results = document.getElementById('results');
        const resultsCount = document.getElementById('resultsCount');
        const errorSection = document.getElementById('errorSection');
        const errorMessage = document.getElementById('errorMessage');

        searchForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Show loading state
            searchBtn.disabled = true;
            searchBtnText.textContent = 'Searching...';
            searchSpinner.classList.remove('hidden');
            resultsSection.classList.add('hidden');
            errorSection.classList.add('hidden');
            
            const formData = new FormData(searchForm);
            const searchData = {
                query: formData.get('query'),
                max_results: parseInt(formData.get('max_results')),
                since: formData.get('since') || null
            };
            
            try {
                const response = await fetch('/api/search', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(searchData)
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || 'Search failed');
                }
                
                displayResults(data);
                
            } catch (error) {
                showError(error.message);
            } finally {
                // Reset button state
                searchBtn.disabled = false;
                searchBtnText.textContent = 'Search Papers';
                searchSpinner.classList.add('hidden');
            }
        });

        function displayResults(data) {
            resultsCount.textContent = `Found ${data.total_papers} papers for "${data.query}"`;
            results.innerHTML = '';
            
            data.results.forEach((paper, index) => {
                const paperCard = createPaperCard(paper, index + 1);
                results.appendChild(paperCard);
            });
            
            resultsSection.classList.remove('hidden');
        }

        function createPaperCard(paper, index) {
            const card = document.createElement('div');
            card.className = 'bg-white rounded-lg shadow-md p-6 card-hover';
            
            if (paper.has_error) {
                card.innerHTML = `
                    <div class="flex items-start space-x-3">
                        <div class="flex-shrink-0 w-8 h-8 bg-red-100 rounded-full flex items-center justify-center">
                            <i class="fas fa-exclamation-triangle text-red-500"></i>
                        </div>
                        <div class="flex-1">
                            <h3 class="text-lg font-semibold text-gray-800 mb-2">${index}. ${paper.title}</h3>
                            <p class="text-red-600">Error: ${paper.error}</p>
                        </div>
                    </div>
                `;
                return card;
            }
            
            const authorsText = paper.authors.join(', ');
            const reviewItems = Object.entries(paper.review)
                .filter(([key, value]) => key !== 'checklist')
                .map(([key, value]) => `<li><strong>${key}:</strong> ${value}</li>`)
                .join('');
            
            const checklistItems = paper.review.checklist ? 
                Object.entries(paper.review.checklist)
                    .map(([key, value]) => `<li><strong>${key}:</strong> ${value}</li>`)
                    .join('') : '';
            
            const ideasList = paper.ideas.map(idea => `<li>${idea}</li>`).join('');
            
            card.innerHTML = `
                <div class="flex items-start space-x-3">
                    <div class="flex-shrink-0 w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                        <span class="text-blue-600 font-bold">${index}</span>
                    </div>
                    <div class="flex-1">
                        <div class="flex items-start justify-between mb-3">
                            <h3 class="text-lg font-semibold text-gray-800 pr-4">${paper.title}</h3>
                            ${paper.gemini_enhanced ? '<span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">AI Enhanced</span>' : ''}
                        </div>
                        
                        <div class="text-sm text-gray-600 mb-3">
                            <p><strong>Authors:</strong> ${authorsText}</p>
                            <p><strong>Published:</strong> ${paper.published}</p>
                            ${paper.pdf_path ? `<p><strong>PDF:</strong> <a href="/api/download/${paper.pdf_path.split('/').pop()}" target="_blank" class="text-blue-600 hover:underline"><i class="fas fa-file-pdf mr-1"></i>Download</a></p>` : ''}
                        </div>
                        
                        <div class="space-y-4">
                            <div>
                                <h4 class="font-semibold text-gray-800 mb-2"><i class="fas fa-file-text mr-2"></i>Summary</h4>
                                <p class="text-gray-700 leading-relaxed">${paper.summary}</p>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold text-gray-800 mb-2"><i class="fas fa-search mr-2"></i>Critical Analysis</h4>
                                <ul class="text-gray-700 space-y-1">
                                    ${reviewItems}
                                </ul>
                                ${checklistItems ? `
                                    <div class="mt-2">
                                        <h5 class="font-medium text-gray-700 mb-1">Methodology Checklist:</h5>
                                        <ul class="text-gray-600 text-sm space-y-1 ml-4">
                                            ${checklistItems}
                                        </ul>
                                    </div>
                                ` : ''}
                            </div>
                            
                            <div>
                                <h4 class="font-semibold text-gray-800 mb-2"><i class="fas fa-lightbulb mr-2"></i>Research Ideas</h4>
                                <ul class="text-gray-700 space-y-1">
                                    ${ideasList}
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            return card;
        }

        function showError(message) {
            errorMessage.textContent = message;
            errorSection.classList.remove('hidden');
        }

        // Set default date to 1 year ago
        const oneYearAgo = new Date();
        oneYearAgo.setFullYear(oneYearAgo.getFullYear() - 1);
        document.getElementById('since').value = oneYearAgo.toISOString().split('T')[0];
    </script>
</body>
</html>
